"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Load the `features.ts` source file, and replace the "V2NEXT" version markers with the actual current version
 */
const fs_1 = require("fs");
const path = require("path");
const flag_modeling_1 = require("../lib/private/flag-modeling");
async function main() {
    const featuresSourceFile = path.join(__dirname, '..', 'lib', 'features.ts');
    let currentv2 = JSON.parse(await fs_1.promises.readFile(path.join(__dirname, '../../../../version.v2.json'), { encoding: 'utf-8' })).version;
    currentv2 = currentv2?.match(/^[0-9\.]+/)?.[0]; // Make sure to only retain the actual version number, not any '-rc.X' suffix
    if (!currentv2) {
        throw new Error('Could not determine current v2 version number');
    }
    let source = await fs_1.promises.readFile(featuresSourceFile, { encoding: 'utf-8' });
    source = source.replace(new RegExp(flag_modeling_1.MAGIC_V2NEXT, 'g'), currentv2);
    await fs_1.promises.writeFile(featuresSourceFile, source, { encoding: 'utf-8' });
}
main().catch(e => {
    // eslint-disable-next-line no-console
    console.error(e);
    process.exitCode = 1;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlLXZuZXh0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXBkYXRlLXZuZXh0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7O0dBRUc7QUFDSCwyQkFBb0M7QUFDcEMsNkJBQTZCO0FBQzdCLGdFQUE0RDtBQUU1RCxLQUFLLFVBQVUsSUFBSTtJQUNqQixNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7SUFFNUUsSUFBSSxTQUFTLEdBQXVCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxhQUFFLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLDZCQUE2QixDQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztJQUN0SixTQUFTLEdBQUcsU0FBUyxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsNkVBQTZFO0lBRTdILElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNmLE1BQU0sSUFBSSxLQUFLLENBQUMsK0NBQStDLENBQUMsQ0FBQztJQUNuRSxDQUFDO0lBRUQsSUFBSSxNQUFNLEdBQUcsTUFBTSxhQUFFLENBQUMsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDMUUsTUFBTSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxNQUFNLENBQUMsNEJBQVksRUFBRSxHQUFHLENBQUMsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUVsRSxNQUFNLGFBQUUsQ0FBQyxTQUFTLENBQUMsa0JBQWtCLEVBQUUsTUFBTSxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7QUFDeEUsQ0FBQztBQUVELElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRTtJQUNmLHNDQUFzQztJQUN0QyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2pCLE9BQU8sQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZCLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMb2FkIHRoZSBgZmVhdHVyZXMudHNgIHNvdXJjZSBmaWxlLCBhbmQgcmVwbGFjZSB0aGUgXCJWMk5FWFRcIiB2ZXJzaW9uIG1hcmtlcnMgd2l0aCB0aGUgYWN0dWFsIGN1cnJlbnQgdmVyc2lvblxuICovXG5pbXBvcnQgeyBwcm9taXNlcyBhcyBmcyB9IGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBNQUdJQ19WMk5FWFQgfSBmcm9tICcuLi9saWIvcHJpdmF0ZS9mbGFnLW1vZGVsaW5nJztcblxuYXN5bmMgZnVuY3Rpb24gbWFpbigpIHtcbiAgY29uc3QgZmVhdHVyZXNTb3VyY2VGaWxlID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJ2xpYicsICdmZWF0dXJlcy50cycpO1xuXG4gIGxldCBjdXJyZW50djI6IHN0cmluZyB8IHVuZGVmaW5lZCA9IEpTT04ucGFyc2UoYXdhaXQgZnMucmVhZEZpbGUocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uLy4uLy4uL3ZlcnNpb24udjIuanNvbicpLCB7IGVuY29kaW5nOiAndXRmLTgnIH0pKS52ZXJzaW9uO1xuICBjdXJyZW50djIgPSBjdXJyZW50djI/Lm1hdGNoKC9eWzAtOVxcLl0rLyk/LlswXTsgLy8gTWFrZSBzdXJlIHRvIG9ubHkgcmV0YWluIHRoZSBhY3R1YWwgdmVyc2lvbiBudW1iZXIsIG5vdCBhbnkgJy1yYy5YJyBzdWZmaXhcblxuICBpZiAoIWN1cnJlbnR2Mikge1xuICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IGRldGVybWluZSBjdXJyZW50IHYyIHZlcnNpb24gbnVtYmVyJyk7XG4gIH1cblxuICBsZXQgc291cmNlID0gYXdhaXQgZnMucmVhZEZpbGUoZmVhdHVyZXNTb3VyY2VGaWxlLCB7IGVuY29kaW5nOiAndXRmLTgnIH0pO1xuICBzb3VyY2UgPSBzb3VyY2UucmVwbGFjZShuZXcgUmVnRXhwKE1BR0lDX1YyTkVYVCwgJ2cnKSwgY3VycmVudHYyKTtcblxuICBhd2FpdCBmcy53cml0ZUZpbGUoZmVhdHVyZXNTb3VyY2VGaWxlLCBzb3VyY2UsIHsgZW5jb2Rpbmc6ICd1dGYtOCcgfSk7XG59XG5cbm1haW4oKS5jYXRjaChlID0+IHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgY29uc29sZS5lcnJvcihlKTtcbiAgcHJvY2Vzcy5leGl0Q29kZSA9IDE7XG59KTsiXX0=